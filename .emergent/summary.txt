<analysis>**original_problem_statement:**
The user's goal is to build FREE11, a cricket prediction and social entertainment platform. The project has undergone several scope resets. The final, locked scope for Phase 1 (Beta) is a single, consolidated product drop.

**PRODUCT REQUIREMENTS (Locked Phase 1 Beta Scope):**
*   **Positioning:** A sports fan community/social entertainment product, NOT a real-money gaming (RMG) or betting app.
*   **Core Loop:** Users participate in free-to-play contests to earn non-financial coins, which are redeemable for real-world goods from a brand-funded catalog.
*   **Core Features:**
    *   **Fantasy Team Contests:** Dream11-style UX for player selection and scoring.
    *   **Prediction Games:** Over Outcome, Match Winner, and limited Ball-by-Ball predictions.
    *   **Card Games:** Rummy, Teen Patti, and Poker (using the same coin economy).
    *   **Social Features:** Private Leagues (P2P, no money), Clans, and Leaderboards.
*   **System Controls:**
    *   **Access:** India-only access (via IP geo-fencing), with no state-level blocking.
    *   **User Gating:** 18+ age gate at registration.
    *   **Economy:** Earn-only coins (non-purchasable, non-withdrawable, non-transferable).
    *   **Admin:** Full admin, support, abuse controls, and feature flags.
*   **Explicitly Excluded:** Cash deposits/withdrawals, buy-ins, ads (AdMob), live player trading, and coin gifting.

**User's preferred language**: English

**what currently exists?**
The application is a functional Progressive Web App (PWA) with a FastAPI backend and React frontend. Core systems like user authentication (with age/country gates), the non-financial coin ledger, a brand-funded shop, and admin controls are in place. The major feature sets required by the Phase 1 scope reset have been stubbed out: backend routes and placeholder frontend pages exist for Fantasy contests, Private Leagues, new prediction types, and most recently, Card Games (Rummy, Teen Patti, Poker). The UI copy has been updated to reflect a social entertainment positioning.

**Last working item**:
-   **Last item agent was working:** Upgrading the Beta scope to include card games. The agent created the basic backend routes (), frontend pages (, ), updated the main server and navigation, and took screenshots of the new placeholder UI to confirm the structure for Rummy, Teen Patti, and Poker.
-   **Status:** IN PROGRESS
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** Both. The backend game logic will require a backend testing agent, and the interactive game UI will require a frontend testing agent.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   There are no outstanding bugs. All work is focused on implementing the new, expanded feature set.

**In progress Task List**:
-   **Task 1: Implement Card Game Logic (P0)**
    -   **Where to resume:**
        1.  **Backend:** Flesh out the placeholder routes in . This requires implementing the full game logic for Rummy, Teen Patti, and Poker, including room creation, state management, player actions, winner determination, and coin distribution.
        2.  **Frontend:** Develop the placeholder  into a functional, interactive user interface for playing the card games. Connect this UI to the new backend endpoints.
    -   **What will be achieved with this?** This will complete the final, upgraded scope for the Phase 1 Beta, making the product feature-complete for user validation.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** Both
    -   **Blocked on something:** None

**Upcoming and Future Tasks**
**Upcoming Tasks:**
*   **P1: Implement Fantasy Team Builder:** The UI () and backend routes are placeholders. Full implementation of the Dream11-style player selection, team validation, and scoring logic is required.
*   **P1: Implement Private Leagues:** The UI () and backend routes () are placeholders. Logic for creating, joining, and managing user-created leagues needs to be built.
*   **P2: Final Beta Validation Deliverables:** After all features are implemented, deliver a final package to the user for sign-off, including a working build, test credentials, a full set of UI screenshots, a user flow document, and a list of known gaps.

**Future Tasks:**
*   **Phase 2: Final MVP:** After user sign-off on the beta, Phase 2 will focus on polishing the UI/UX and ensuring production-grade stability. No new core features will be added.
*   **Native Build:** Create a native Android build (APK/AAB) using a wrapper technology like Capacitor or React Native.

**Completed work in this session**
-   **Admin Dashboard Fix:** Resolved an issue where the Admin Beta Dashboard showed all-zero metrics by implementing the missing frontend API call.
-   **Phase 1 Scope Reset Implementation:**
    -   **New Prediction Formats:** Added Over Outcome and Match Winner predictions to the frontend and backend, and capped Ball-by-Ball predictions.
    -   **Access Control:** Implemented an 18+ age gate and an IP-based geo-fence to restrict access to India-only. Removed all state-level blocking.
    -   **Feature Stubs:** Created placeholder routes and UI pages for Fantasy Team Contests, Private Leagues, and Feature Flags.
    -   **Refactoring:** Removed all Ads related features, routes, and UI components (, etc.) to align with the new scope. Updated UI copy to reflect a social entertainment positioning.
-   **MVP 1.5 Scope Merge:**
    -   **Card Games Integration:** Integrated Rummy, Teen Patti, and Poker into the beta. Created backend routes () and placeholder frontend pages (, ), and updated the site navigation.
-   **Beta Invite Management:** Reset all 50 beta invite codes with fresh uses and new expiration dates.
-   **UX Audit & Reporting:** Provided multiple sets of UI screenshots, a composite image, and updated documentation (, ) to reflect the evolving scope for user validation.

**Earlier issues found/mentioned but not fixed**
-   None.

**Known issue recurrence from previous fork**
-   None. The previously recurring / issue was resolved and did not reappear.

**Code Architecture**


**Key Technical Concepts**
*   **Backend:** FastAPI, MongoDB, Pydantic
*   **Frontend:** React, Tailwind CSS, shadcn/ui
*   **Authentication:** JWT, Role-based access (Admin)
*   **Access Control:** IP-based geo-fencing for country restriction, age verification at signup.
*   **System Design:** Feature Flags for toggling functionality.

**key DB schema**
-   ****: 
-   ****: 
-   ****: (Schema to be defined)
-   ****: (Schema to be defined for game state, rooms, etc.)

**changes in tech stack**
-    was installed in the backend for image manipulation.
-   An external IP geolocation service () is used for country-blocking.

**All files of reference**
*   **Card Game Files (In Progress):**
    *   : Backend logic placeholder.
    *   : Card game selection hub UI.
    *   : Game table UI placeholder.
*   **Access Control Files:**
    *   : Contains the server-side India-only IP check.
    *   : Contains the frontend UI for age and country selection.
*   **New Prediction Format Files:**
    *   : Contains backend logic for Over/Winner predictions.
    *   : Contains frontend UI for the new prediction types.
*   **Core Route Files:**
    *   : Main router including all new route modules.
    *   : Main frontend router including all new pages.

**Areas that need refactoring**
-   The password hashing logic is duplicated in  and  and should be moved to a shared utility.
-   The new game logic for Rummy, Poker, and Teen Patti should be structured in a modular way within  to avoid creating a monolithic and unmaintainable file.

**key api endpoints**
*   : **(POST)** Registers a user, now with server-side checks for age (18+) and country (India-only).
*   : **(POST)** New endpoint to submit an Over Outcome prediction.
*   : **(POST)** New endpoint to submit a Match Winner prediction.
*   : **(GET)** New endpoint to fetch details for a specific card game.
*   : **(GET)** New endpoint to fetch the status of all feature flags.
*   : **(GET/POST)** New endpoints for managing private leagues.

**Critical Info for New Agent**
*   **Primary Goal:** The immediate priority is to implement the full gameplay logic for the three card games: Rummy, Teen Patti, and Poker. The current implementation is only a non-functional placeholder.
*   **Scope Lock:** The user has locked the scope for Phase 1 Beta. Do not introduce new features. Focus on implementing the defined list: Fantasy, Private Leagues, and the card games.
*   **Product Positioning:** All new development and copy must adhere to the social entertainment and fan community model. Avoid any language or features related to betting, gambling, or real-money gaming.
*   **Consolidated Delivery:** The user expects all remaining Phase 1 features to be delivered in a single, consolidated drop, not piecemeal.

**documents and test reports created in this job**
*   
*    (repeatedly updated)
*   
*   

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Requests a composite screenshot of all major flows.
2.  **Agent:** Creates and provides the composite image.
3.  **User:** Re-requests real manual screenshots, stating bot logs don't count.
4.  **Agent:** Takes and provides a series of manual screenshots for all key pages.
5.  **User:** **Upgrades scope.** Merges MVP 1.5 into the Beta, requesting the addition of Rummy, Teen Patti, and Poker with the same coin model.
6.  **Agent:** Acknowledges the scope upgrade and begins implementation.
7.  **Agent:** (after implementation) Shares screenshots of the new Card Games hub and game selection screens.
8.  **User:** No pending messages. The user is waiting for the implementation of the card games.

**Project Health Check:**
*   **Broken:**
    *   **Card Games:** The entire card game module is non-functional. Routes and UI are placeholders.
    *   **Fantasy Contests:** The fantasy team builder is a non-functional placeholder page.
    *   **Private Leagues:** The private leagues feature is a non-functional placeholder.
*   **Mocked:**
    *   Live cricket data is still from a static mock file.
    *   Voucher/product delivery upon redemption is mocked.

**3rd Party Integrations**
*   **Resend:** For transactional emails.
*   **ip-api.com:** A free geo-IP service used for enforcing India-only access.

**Testing status**
-   **Testing agent used after significant changes:** YES, but this was *before* the card game scope was added.
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** None
-   **Known regressions:** None

**Credentials to test flow:**
*   **Admin User:**
    *   Email: 
    *   Password: 
*   **Beta Invite Codes:** , , ...,  (case-insensitive).

**What agent forgot to execute**
-   The agent correctly followed the user's instructions to stub out the card game features. The next logical step, which has not yet been executed, is the full implementation of the game logic for Rummy, Poker, and Teen Patti.</analysis>
